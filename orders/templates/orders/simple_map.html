{% extends 'base.html' %}
{% load static %}

{% block title %}Orders Map - Laundry Pal{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tF/miZyoHS5obTRR9BMY="
      crossorigin=""/>
<style>
    #map {
        height: 600px;
        width: 100%;
        border-radius: 8px;
        margin: 1rem 0;
        border: 1px solid #ddd;
    }
    .map-container {
        position: relative;
    }
    .map-overlay {
        position: absolute;
        top: 20px;
        left: 20px;
        z-index: 1000;
        background: white;
        padding: 10px;
        border-radius: 4px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="display-6 fw-bold text-primary mb-0">Orders Map</h2>
    </div>

    <div class="map-container">
        <div id="map"></div>
        <div class="map-overlay">
            <h6 class="fw-bold mb-2">Order Status</h6>
            <div class="d-flex flex-wrap gap-2">
                <span class="badge bg-primary">Pending</span>
                <span class="badge bg-info">Processing</span>
                <span class="badge bg-warning">Washing</span>
                <span class="badge bg-success">Ready</span>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin=""></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize the map
    const map = L.map('map').setView([11.5833, 124.4667], 14);
    
    // Add OpenStreetMap tiles
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        maxZoom: 19,
    }).addTo(map);
    
    // Add scale control
    L.control.scale().addTo(map);
    
    // Sample order data (replace with your actual data)
    const orders = [
        {
            id: 1,
            number: 'ORD-001',
            status: 'pending',
            address: '123 Main St, Naval, Biliran',
            lat: 11.5833,
            lng: 124.4667,
            created: 'Nov 6, 2023',
            total: '250.00'
        },
        {
            id: 2,
            number: 'ORD-002',
            status: 'processing',
            address: '456 Oak St, Naval, Biliran',
            lat: 11.5840,
            lng: 124.4680,
            created: 'Nov 6, 2023',
            total: '350.00'
        }
    ];
    
    // Add markers for each order
    orders.forEach(order => {
        let markerColor;
        
        // Set marker color based on status
        switch(order.status) {
            case 'pending':
                markerColor = '#0d6efd'; // blue
                break;
            case 'processing':
                markerColor = '#0dcaf0'; // cyan
                break;
            case 'washing':
                markerColor = '#ffc107'; // yellow
                break;
            case 'ready':
                markerColor = '#198754'; // green
                break;
            default:
                markerColor = '#6c757d'; // gray
        }
        
        // Create a custom icon
        const icon = L.divIcon({
            html: `<div style="background-color: ${markerColor}; width: 20px; height: 20px; border-radius: 50%; border: 2px solid white;"></div>`,
            className: 'custom-marker',
            iconSize: [24, 24],
            iconAnchor: [12, 12],
            popupAnchor: [0, -12]
        });
        
        // Add marker to map
        const marker = L.marker([order.lat, order.lng], { icon: icon }).addTo(map);
        
        // Add popup
        marker.bindPopup(`
            <div style="min-width: 200px;">
                <h6 class="fw-bold mb-1">Order #${order.number}</h6>
                <p class="mb-1">Status: <span class="badge bg-${order.status === 'pending' ? 'primary' : 
                    order.status === 'processing' ? 'info' : 
                    order.status === 'washing' ? 'warning' : 'success'}">
                    ${order.status.charAt(0).toUpperCase() + order.status.slice(1)}
                </span></p>
                <p class="mb-1">${order.address}</p>
                <p class="mb-1">Total: â‚±${order.total}</p>
                <div class="d-grid mt-2">
                    <a href="/orders/${order.id}/" class="btn btn-sm btn-outline-primary">
                        View Details
                    </a>
                </div>
            </div>
        `);
    });
    
    // Fit map to bounds of all markers
    const group = new L.featureGroup(orders.map(order => 
        L.marker([order.lat, order.lng]))
    );
    map.fitBounds(group.getBounds().pad(0.1));
    
    console.log('Map initialized successfully!');
});
</script>
{% endblock %}
