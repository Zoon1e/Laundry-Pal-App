{% extends 'base.html' %}
{% load static %}

{% block title %}
    {% if object %}Edit Reservation{% else %}New Reservation{% endif %} - Laundry Pal
{% endblock %}

{% block extra_css %}
<link href="{% static 'css/reservation-form.css' %}" rel="stylesheet">
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/reservation-enhanced.js' %}"></script>
{% endblock %}

{% block content %}
<div class="reservation-container">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <!-- Header -->
                <div class="reservation-header">
                    <h2>{% if object %}Edit Reservation{% else %}Schedule Pickup{% endif %}</h2>
                    <p>{% if object %}Update your reservation details{% else %}Book your laundry pickup and delivery{% endif %}</p>
                </div>

                <!-- Form Card -->
                <div class="reservation-card">
                    <div class="p-4">
                    <form method="post" class="needs-validation" novalidate>
                        {% csrf_token %}
                        
                        <!-- Service Type Selection -->
                        <div class="section-header">
                            <i class="fas fa-cog" style="color: #2563eb;"></i>
                            <h3>Service Type</h3>
                        </div>
                        <div class="service-grid">
                            <div class="service-card">
                                <input type="radio" name="service_type" id="wash_fold" value="1">
                                <label class="service-label" for="wash_fold">
                                    <i class="fas fa-tshirt service-icon" style="color: #2563eb;"></i>
                                    <div class="service-name">Wash & Fold</div>
                                    <div class="service-price">₱750 base + ₱100/item</div>
                                </label>
                            </div>
                            <div class="service-card">
                                <input type="radio" name="service_type" id="dry_cleaning" value="2">
                                <label class="service-label" for="dry_cleaning">
                                    <i class="fas fa-user-tie service-icon" style="color: #06b6d4;"></i>
                                    <div class="service-name">Dry Cleaning</div>
                                    <div class="service-price">₱1,250 base + ₱400/item</div>
                                </label>
                            </div>
                            <div class="service-card">
                                <input type="radio" name="service_type" id="premium_care" value="3">
                                <label class="service-label" for="premium_care">
                                    <i class="fas fa-crown service-icon" style="color: #fbbf24;"></i>
                                    <div class="service-name">Premium Care</div>
                                    <div class="service-price">₱1,750 base + ₱250/item</div>
                                </label>
                            </div>
                        </div>

                        <!-- Priority Selection -->
                        <div class="section-header">
                            <i class="fas fa-exclamation-circle" style="color: #fbbf24;"></i>
                            <h3>Priority Level</h3>
                        </div>
                        <div class="priority-grid">
                            <div class="priority-card priority-standard">
                                <input type="radio" name="priority" id="standard" value="standard" checked>
                                <label class="priority-label" for="standard">
                                    <i class="fas fa-clock priority-icon"></i>
                                    <div class="priority-name">STANDARD<br>(3-5 DAYS)</div>
                                </label>
                            </div>
                            <div class="priority-card priority-express">
                                <input type="radio" name="priority" id="express" value="express">
                                <label class="priority-label" for="express">
                                    <i class="fas fa-shipping-fast priority-icon"></i>
                                    <div class="priority-name">EXPRESS (24H)<br>+₱500</div>
                                </label>
                            </div>
                            <div class="priority-card priority-rush">
                                <input type="radio" name="priority" id="rush" value="rush">
                                <label class="priority-label" for="rush">
                                    <i class="fas fa-bolt priority-icon"></i>
                                    <div class="priority-name">RUSH (SAME DAY)<br>+₱1,250</div>
                                </label>
                            </div>
                        </div>

                        <!-- Schedule Section -->
                        <div class="section-header">
                            <i class="fas fa-calendar-alt" style="color: #2563eb;"></i>
                            <h3>Pickup & Delivery Schedule</h3>
                        </div>
                        <div class="datetime-grid">
                            <div class="form-group">
                                <label for="{{ form.pickup_datetime.id_for_label }}" class="form-label">
                                    <i class="fas fa-arrow-up" style="color: #2563eb;"></i>Pickup Date & Time
                                </label>
                                <input type="datetime-local" 
                                       class="form-control" 
                                       id="{{ form.pickup_datetime.id_for_label }}" 
                                       name="{{ form.pickup_datetime.name }}" 
                                       value="{{ form.pickup_datetime.value|default:'' }}"
                                       required>
                            </div>
                            <div class="form-group">
                                <label for="{{ form.delivery_datetime.id_for_label }}" class="form-label">
                                    <i class="fas fa-arrow-down" style="color: #06b6d4;"></i>Delivery Date & Time
                                </label>
                                <input type="datetime-local" 
                                       class="form-control" 
                                       id="{{ form.delivery_datetime.id_for_label }}" 
                                       name="{{ form.delivery_datetime.name }}" 
                                       value="{{ form.delivery_datetime.value|default:'' }}"
                                       required>
                            </div>
                        </div>

                        <!-- Address Section -->
                        <div class="section-header">
                            <i class="fas fa-map-marker-alt" style="color: #ef4444;"></i>
                            <h3>Contact Information</h3>
                        </div>
                        <div class="form-group" style="margin-bottom: 1.5rem;">
                            <label for="{{ form.address.id_for_label }}" class="form-label">
                                <i class="fas fa-map-marker-alt" style="color: #ef4444;"></i>Pickup & Delivery Address
                            </label>
                            <textarea class="form-control" 
                                      id="{{ form.address.id_for_label }}" 
                                      name="{{ form.address.name }}" 
                                      rows="3" 
                                      placeholder="Enter your complete address including apartment/unit number..."
                                      required>{{ form.address.value|default:'' }}</textarea>
                        </div>

                        <div class="form-group" style="margin-bottom: 1.5rem;">
                            <label for="phone_number" class="form-label">
                                <i class="fas fa-phone" style="color: #06b6d4;"></i>Phone Number
                            </label>
                            <input type="tel" 
                                   class="form-control" 
                                   id="phone_number" 
                                   name="phone_number" 
                                   placeholder="(555) 123-4567"
                                   value="{{ form.phone_number.value|default:'' }}">
                        </div>

                        <div class="form-group" style="margin-bottom: 2rem;">
                            <label for="{{ form.notes.id_for_label }}" class="form-label">
                                <i class="fas fa-sticky-note" style="color: #64748b;"></i>Special Instructions (Optional)
                            </label>
                            <textarea class="form-control" 
                                      id="{{ form.notes.id_for_label }}" 
                                      name="{{ form.notes.name }}" 
                                      rows="3" 
                                      placeholder="Any special instructions, stain information, or preferences...">{{ form.notes.value|default:'' }}</textarea>
                        </div>

                        <!-- Cost Estimate -->
                        <div class="info-alert">
                            <i class="fas fa-calculator"></i>
                            <div class="info-alert-content">
                                <h6>Estimated Cost</h6>
                                <p>Base service fee + per-item charges will be calculated after pickup inspection. Final cost may vary based on actual items and services required.</p>
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div class="form-actions">
                            <a href="{% url 'reservations:reservation_list' %}" class="btn btn-secondary">
                                <i class="fas fa-arrow-left"></i>Cancel
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-{% if object %}save{% else %}calendar-check{% endif %}"></i>
                                {% if object %}Update Reservation{% else %}Schedule Pickup{% endif %}
                            </button>
                        </div>
                    </form>
                </div>
            </div>

                <!-- Help Section -->
                <div class="help-section">
                    <div class="help-card">
                        <i class="fas fa-clock help-icon" style="color: #2563eb;"></i>
                        <h6>Flexible Scheduling</h6>
                        <p>Choose pickup and delivery times that work for your schedule.</p>
                    </div>
                    <div class="help-card">
                        <i class="fas fa-shield-alt help-icon" style="color: #10b981;"></i>
                        <h6>Safe & Secure</h6>
                        <p>Your items are tracked and insured throughout the process.</p>
                    </div>
                    <div class="help-card">
                        <i class="fas fa-headset help-icon" style="color: #06b6d4;"></i>
                        <h6>24/7 Support</h6>
                        <p>Contact us anytime if you need to modify your reservation.</p>
                    </div>
                </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Auto-calculate delivery time based on priority
    const priorityInputs = document.querySelectorAll('input[name="priority"]');
    const pickupInput = document.getElementById('{{ form.pickup_datetime.id_for_label }}');
    const deliveryInput = document.getElementById('{{ form.delivery_datetime.id_for_label }}');
    
    function updateDeliveryTime() {
        if (!pickupInput.value) return;
        
        const pickupDate = new Date(pickupInput.value);
        const priority = document.querySelector('input[name="priority"]:checked').value;
        let deliveryDate = new Date(pickupDate);
        
        switch(priority) {
            case 'rush':
                deliveryDate.setHours(deliveryDate.getHours() + 8); // Same day
                break;
            case 'express':
                deliveryDate.setDate(deliveryDate.getDate() + 1); // Next day
                break;
            default:
                deliveryDate.setDate(deliveryDate.getDate() + 3); // 3 days
        }
        
        deliveryInput.value = deliveryDate.toISOString().slice(0, 16);
    }
    
    priorityInputs.forEach(input => {
        input.addEventListener('change', updateDeliveryTime);
    });
    
    pickupInput.addEventListener('change', updateDeliveryTime);
    
    // Form validation
    const form = document.querySelector('.needs-validation');
    form.addEventListener('submit', function(event) {
        if (!form.checkValidity()) {
            event.preventDefault();
            event.stopPropagation();
        }
        form.classList.add('was-validated');
    });
});
</script>
{% endblock %}
